Access Token:- After login users will receive it.
Refresh Token:- If current access token expires, refresh token is used to get a new access token without user credentials.
                Refresh token should be stored securely on client side.
                If it is used to logout then the associated access token will become inactive then user will have to login again.
realm-management :- This default keycloak's client is used to assign permissions to all the other clients.


ADMIN_CLIENT Usage:
    1. To create/update app clients.
    2. Register(create) users.
    3. Has realm-management roles(like manage-users, manage-clients, manage-realm)
    4. Has grant type "client_credentials" (used for machine to machine authentication where client needs to authenticate itself to an authorization server(Keycloak)
        to access protected resources Keycloak's Admin API)
    5. Has authentication flow: Standard flow, Direct Access Grants, Service accounts roles.
    6. Service account roles: manage-client, view client, manage_user, manage_realm, query_users.

APP_CLIENT Usage:
    1. To login/logout and introspect user.
    2. Has DirectAccessGrantsEnabled(to access user credentials for tokens),
    3. Has authentication flow: Standard flow, Direct Access Grants, Service accounts roles.


Login endpoint response:-
    1. access_token ="";        //to access resources
    2. refresh_token = "";
    3. expires_in = access_token_ lifespan in seconds;
    4. refresh_expires_in = refresh_token lifespan in seconds;
    5. token_type = "Bearer";  //always bearer. It is sent to the keycloak server like this: "Authorization:Bearer<access token>"
    6. not-before-policy = 0;   //time before which the token must not be accepted
                            //0 means token can be used immediately
                //It is used for situation where a token might be issued but not become valid until a certain time.
    7. session_state = user's session unique value. Used to track active sessions/logout notifications.
                    //It is used to identify different sessions for the same user.

    8. scope = list of permissions granted to the access token separated by space.
                E.g. scopes : "Profile email"
                    So, access token can be used to retrieve user's profile info and email id from Kecyloak's UserInfo endpoint(if that endpoint is exposed and configured).
                Keycloak by default grants profile,email,openid etc scopes at the time client is created.
                The openid, offline_access are internal scopes of keycloak so they are not seen in endpoint's response  


To register users:-
    1.ADMIN_CLIENT should have these permisisons/roles from realm-management client:-
        a. manage-clients :- create/update/delete clients.
        b. view-clients :- view clients. 
        c. manage-users :- create/delete/update user and user sessions.
        d. manage-realm :- create/delete realms
        e. query-users :- search user info in realm.

####################################################################################################################################################
H2 embedded database
If keycloak server is started with this command: ./bin/kc.sh start-dev
then Keycloak uses H2 embedded database(runs inside keycloak) stored in data/h2/keycloakdb.*
On this location:
    (venv) ak@ak-OptiPlex-Micro-Plus-7010:~/Projects/QIAM/keyclk/keycloak-api-client/keycloak-26.4.1/data/h2$ ls
    keycloakdb.mv.db      --Main database file(data)
    keycloakdb.trace.db     --Optional trace log

Reason for not using H2 embedded database:
1. For development only
2. Can't work under:
    1.High traffic
    2.File corruption risk
    3.Concurrent access

Note:- 
    1.Postgresql is being used for production

When the user logs in the Keycloak creates two sessions:
1.Browser SSO session : Stored as cookies in Keycloak_session.
2.Client session : For the application(in this case FastAPI client app).

##############################################################################################################################################
Sessions
1.The time upto which we can see the user's session is set through :
    Realm Settings->Sessions->SSO Session Settings :
        1. SSO Session Idle : 1 hour 
            -> After login untill this time user will be visible in sessions tab
            -> If user inactivity is found, refresh token expires, user has to login again.
        2. SSO Session Max : 1 day
            -> After this time refresh token expires, user has to login again.
        3. SSO Session Idle Remember Me :
        4. SSO Session Max Remember Me :

        Note: If all 4 are checked then session idle and session max are applied.

###############################################################################################################################################
Tokens 
    1.Token timeline:
        Case 1: 
            Realm = demo
            Realm settings->Sessions->Client session settings(both are blank)
            Tokens->Access tokens->Access Token Lifespan(is the access token expiry time)
        Case 2:
            Realm = demo
            Realm settings->Sessions->Client session settings->Client Session Idle =5 minute 
                                                             ->Client Session Max = 3 minutes( is the access and refresh token expiry time)
                                                                - so user must use refresh token to get new access token within 3 minutes



